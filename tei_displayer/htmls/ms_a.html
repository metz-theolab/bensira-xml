<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Transformation XSLT</title>
</head>
<body>
  <div id="output">Transformation en cours...</div>
<script>
  async function transformXML() {
    try {
      // Ajoute un timestamp pour éviter le cache
      const xmlUrl = '../../tei_files/ms_a.xml?t=' + new Date().getTime();
      const xslUrl = 'to_html.xslt'; // Le XSLT change rarement, donc pas besoin de forcer le reload

      const xmlRes = await fetch(xmlUrl, {cache: "no-store"});
      const xslRes = await fetch(xslUrl, {cache: "no-store"});
      if (!xmlRes.ok || !xslRes.ok) throw new Error('Fichier XML ou XSLT introuvable');
      const xmlText = await xmlRes.text();
      const xslText = await xslRes.text();

      const parser = new DOMParser();
      const xml = parser.parseFromString(xmlText, 'text/xml');
      const xsl = parser.parseFromString(xslText, 'text/xml');

      const xsltProcessor = new XSLTProcessor();
      xsltProcessor.importStylesheet(xsl);
      const resultDocument = xsltProcessor.transformToFragment(xml, document);

      const output = document.getElementById('output');
      output.innerHTML = "";
      output.appendChild(resultDocument);
    } catch (e) {
      document.getElementById('output').innerText = "Erreur : " + e;
    }
  }

  // Recharge et transforme toutes les 5 secondes
  setInterval(transformXML, 5000);
  // Lance une première fois au chargement
  transformXML();
</script>
</body>
</html>